# 仪表库

学习如何为您的库添加本地仪表。

OpenTelemetry 为许多库提供仪表库，通常是通过库钩子或猴子补丁库代码完成的。

使用 OpenTelemetry 进行本地库仪表可以为用户提供更好的可观测性和开发人员体验，消除了库公开和记录钩子的需求：

- 自定义日志钩子可以被常见的、易于使用的 OpenTelemetry API 所取代，用户将只与 OpenTelemetry 进行交互。
- 来自库和应用程序代码的追踪、日志、指标是相互关联且一致。
- 共同的约定允许用户在相同的技术、不同的库和语言中获得相似和一致的遥测数据。
- 使用广泛记录的 OpenTelemetry 可扩展性点，可以为各种消费方案微调（过滤、处理、聚合）遥测信号。

## 语义约定

检查一下可用的语义约定，这些约定涵盖了网络框架、RPC 客户端、数据库、信息传递客户端、基础设施等等！

如果你的库是这些东西之一，请遵循这些规则，它们是真相的主要来源，并告诉哪些信息应该包含在跨度中。规则使仪表一致：使用遥测的用户不必学习库的细节，可观测性供应商可以为各种技术（例如数据库或消息系统）构建体验。当库遵循约定时，许多场景可以在用户的输入或配置下自动启用。

如果你有任何反馈或想添加一个新的约定--请来贡献吧 [Instrumentation Slack](https://cloud-native.slack.com/archives/C01QZFGMLQ7) 或 [Specification 仓库](https://github.com/open-telemetry/opentelemetry-specification) 是一个很好的开始。

## 何时不仪表化

有些库是仅仅封装了网络调用的薄客户端。OpenTelemetry 很可能已经为底层 RPC 客户端提供了仪表库（请查看注册表）。在这种情况下，仪表化封装库可能是不必要的。

如果符合以下条件，则不要仪表化：

- 您的库是文档化的或者是自我解释(self-explanatory)的 API 的薄代理
- OpenTelemetry 为底层网络调用提供了仪器库
- 你的库在丰富遥测内容方面没有任何约定可循

如果您有疑问，就不要仪表化 - 您可以在以后需要的时候随时这样做。

如果你选择不检测，为你的内部 RPC 客户端实例提供一种配置 OpenTelemetry 处理程序的方法可能仍然有用。这在不支持完全自动检测的语言中是必不可少的，而在其他语言中仍然有用。

如果你决定这样做，本文档的其余部分将对测量什么和如何进行测量提供指导。

## OpenTelemetry API

